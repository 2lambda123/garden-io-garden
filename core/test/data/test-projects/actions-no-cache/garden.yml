kind: Build
name: test-build-container
type: container
include: [.]

---
kind: Deploy
type: container
name: test-deploy-container
build: test-build-container
cache:
  exclude:
    variables:
      - ${var.base-hostname}
description: Deploy the container
spec:
  ports:
    - name: http
      containerPort: 80
      servicePort: 8080
  healthCheck:
    httpGet:
      path: /
      port: http
  ingresses:
    - path: /
      port: http
      hostname: foo.${var.base-hostname}
  # env:
  #   HOSTNAME: foo.${var.base-hostname}
  #   VITE_USERNAME: ${local.username}

---
kind: Deploy
type: container
name: test-deploy-container-with-merge
build: test-build-container
cache:
  exclude:
    variables:
      - ${var.base-hostname}
      - ${var.nestedVars.EXTERNAL_API_URL}
description: Deploy the container
spec:
  ports:
    - name: http
      containerPort: 8080
      servicePort: 80
  healthCheck:
    httpGet:
      path: /
      port: http
  ingresses:
    - path: /
      port: http
      hostname: foo.${var.base-hostname}
  env:
    $merge: ${var.nestedVars}

# E2E Runner configs
---
kind: Build
name: e2e-runner
type: container

# ---
# kind: Deploy
# type: container
# name: e2e-runner
# dependencies: [deploy.test-deploy-container]
# build: test-build-container

---
kind: Test
type: container
name: e2e-test
build: e2e-runner
dependencies: [deploy.test-deploy-container]
spec:
  args: [echo, hello]

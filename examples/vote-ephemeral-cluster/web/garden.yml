kind: Build
name: web
type: container

---
kind: Deploy
description: The voting UI
name: web
type: container
build: web
dependencies:
  - deploy.api

spec:
  args: [npm, run, serve]
  ports:
    - name: http
      containerPort: 8080
      servicePort: 80
  healthCheck:
    httpGet:
      path: /
      port: http
  ingresses:
    - path: /
      port: http
      hostname: web.${providers.ephemeral-kubernetes.outputs.default-hostname}
  env:
    HOSTNAME: web.${providers.ephemeral-kubernetes.outputs.default-hostname}
  sync:
    paths:
      - target: /app/src
        source: src
        mode: one-way-replica
        exclude: [node_modules]

---
kind: Test
name: web-unit
type: container
build: web
spec:
  args: [npm, run, test:unit]

---

kind: Test
name: e2e-runner
type: container
build: web
dependencies: [deploy.api]
spec:
  args: [npm, run, test:integ]


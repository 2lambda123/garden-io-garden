kind: Module
name: backend
description: Backend service container
type: container
dockerfile: proxy.dockerfile
buildArgs:
  PUBLIC_KEY_FILE: ${var.proxyContainerPublicKeyFile}

# You can specify variables here at the module level
variables:
  ingressPath: /hello-backend
  localAppPort: "8090"
  localSshPort: "2222"
  proxyContainerPublicKeyFile: proxy-key.pub
  proxyContainerUserName: proxy-user

services:
  - name: backend # backend replacement container
    localMode:
      localAppPort: ${var.localAppPort}
      localSshPort: ${var.localSshPort}
      command: [] # example: [ "npm", "run", "serve", "-p", "${var.localAppPort}" ]
      remoteContainerName: remote-app-container
    env:
      PUBLIC_KEY_FILE: ${var.proxyContainerPublicKeyFile}
      USER_NAME: ${var.proxyContainerUserName}
    healthCheck:
      httpGet:
        path: /hello-backend
        port: http
    ports:
      - name: http
        containerPort: 8080
        # Maps service:80 -> container:8080
        servicePort: 80
    ingresses:
      - path: ${var.ingressPath}
        port: http

tasks:
  - name: test
    command: ["sh", "-c", "echo task output"]

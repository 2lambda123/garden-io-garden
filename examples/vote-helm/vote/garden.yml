kind: Deploy
description: Helm chart for the voting UI
type: helm
name: vote

dependencies:
  - deploy.api

variables:
  hostname: vote.${var.baseHostname}

spec:
  defaultTarget:
    kind: Deployment
    name: vote
  sync:
    paths:
      - containerPath: /app/src
        sourcePath: ${action.build.vote-image.sourcePath}/src
        mode: two-way
  values:
    image:
      repository: ${action.build.vote-image.outputs.deployment-image-name}
      tag: ${action.build.vote-image.version}
    ingress:
      enabled: true
      paths: [/]
      hosts: ["${var.hostname}"]
    env:
      - name: HOSTNAME
        value: ${var.hostname}

---

kind: Test
name: vote-integ
type: kubernetes-exec
dependencies:
  - deploy.vote
timeout: 60
spec:
  resource:
    kind: Deployment
    name: vote
  args: [npm, run, test:integ]

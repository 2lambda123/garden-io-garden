kind: Build
name: backend
type: container

---
kind: Deploy
name: backend
description: Backend service container
type: container
build: backend

variables:
  sync-mode: ${command.params contains 'sync' && (command.params.sync contains '<module-name>' || isEmpty(command.params.sync))}
  httpPort:
    name: http
    containerPort: 8080
  debugPort:
    name: debug
    containerPort: 12345
    localPort: 12345

spec:
  replicas: ${var.service-replicas} # <- Refers to the variable set in the project config
  ports: "${var.sync-mode == true ? [var.httpPort, var.debugPort] : [var.httpPort] }"
  ingresses:
    - path: /hello-backend
      port: http

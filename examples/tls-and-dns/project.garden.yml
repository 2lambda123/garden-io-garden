kind: Project
name: tls-and-dns
defaultEnvironment: local

environments:
  - name: prod
    production: true
    defaultNamespace: ${var.DEFAULT_NAMESPACE}
    variables:
      base-hostname: ${var.CF_DOMAIN[0]} # This is the domain we want to use for our services, select one of the CF_DOMAIN array
  - name: local
    defaultNamespace: ${var.DEFAULT_NAMESPACE}
    variables:
      base-hostname: local.app.garden

providers:
  - name: kubernetes
    environments: [prod]
    context: garden-dns-tls-test # Make sure to change this to your own context
    namespace: ${var.DEFAULT_NAMESPACE}
    buildMode: kaniko
    setupIngressController: nginx
    # tlsCertificates: # You can start testing this with the staging certificates, but you should use production certificates in production
    #   - name: staging-cert-wildcard
    #     secretRef:
    #       name: staging-cert-wildcard
  - name: local-kubernetes
    environments: [local]
    context: docker-desktop # Make sure to change this to your own context
    namespace: ${var.DEFAULT_NAMESPACE}
    defaultHostname: ${var.base-hostname}
    setupIngressController: nginx

variables:
  DEFAULT_NAMESPACE: default # Frontend will be deployed in this namespace.
  # Cert-Manager variables
  CERT_MANAGER_INSTALL_CRDS: true
  GENERATE_PROD_CERTS: true # Set this to true if you want to generate production certificates
  GENERATE_STG_CERTS: true # Set this to true if you want to generate staging certificates
  # External-DNS variables
  CF_DNS_PROVIDER: cloudflare # This demo only supports Cloudflare at the moment
  CF_DOMAIN: [ change-me.com ] # Has to be an array, even if you only have one domain
  CF_UPDATE_STRATEGY: sync # Be careful with this, it can cause downtime if you're not careful
  CF_EMAIL: email@change-me.com # This is the email you use to login to Cloudflare
  CF_PROXIED: false # Set this to true if you want to use Cloudflare's proxy service, it won't work with cert-manager if you do
